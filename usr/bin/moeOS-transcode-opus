#!/bin/bash

function main(){
	pathPre=$(pwd)
	mkdir transcoded
	cycleTotal=$(ls . | wc -l)
	cycle=1
	while [[ cycleTotal -gt $(expr ${cycle} - 1) ]]; do
		transcodeSingle "$(ls . | head -n ${cycle} | tail -n 1)"
		cycle=$(expr ${cycle} + 1)
	done
}

function transcodeSingle(){
	if [[ -d "$1" ]]; then
		return 0
	fi
	random=${RANDOM}
	ffmpeg -hide_banner -loglevel error -i "$1" -i metadata.json -map_metadata:s:a 0:g -af dynaudnorm=g=45:p=0.5:m=1:s=0 ./transcoded/"$1.opus"
}


main